<html>
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone=no" name="format-detection" />
    <!-- 引入字体图标 -->
    <link rel="stylesheet" href="../font/iconfont.css">
    <!-- 引入YDUI样式 -->
    <link rel="stylesheet" href="../frame/ydui-0.1.3/build/css/ydui.css" />
    <link rel="stylesheet" href="../css/dfjnkd.css">
  <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../font/iconfont3.css">
    <!-- 引入YDUI自适应解决方案类库 -->
    <script src="../frame/ydui-0.1.3/build/js/ydui.flexible.js"></script>
</head>
<body>
    <!-- 代码区 g-scrollview-->
    <section class="">
        <!-- 头部 -->
        <header class="m-navbar">
                <a href="#" class="navbar-item">
                    <i class="icon-shopcart-outline"></i>
                </a>
                <div class="navbar-center">
                    <span class="navbar-title">我的购物车车</span>
                </div>
                <div class="navbar-item">
                   
                    <a href="#">
                        <i class="icon-ucenter-outline"></i>
                    </a>
                    <a href="#" onclick=delcar()>
                        <i class="icon-delete"></i>
                    </a>
                </div>
            </header>

<div class="shopcar">
    

</div>




    <!-- 登录页 --></section>

    <div class="dfdsfhthyj">
        <div class="cell-item">
            <div class="sfsdggg">总价格：<span class="foiuhro"></span></div>
            <a href="javascript:;" class="btn btn-warning dafsgas">结算</a>
        </div>
       
    </div>
       

<!--  -->
    
        <footer class="m-tabbar tabbar-fixed">
            <a href="#" class="tabbar-item">
                <span class="tabbar-icon">
                    <i class="iconfont">&#xe619;</i>
                </span>
                <span class="tabbar-txt">首页</span>
            </a>
            <a href="#" class="tabbar-item">
                <i class="iconfont">
                    &#xe61b;
                </i>
                <span class="tabbar-txt">衣媒</span>
            </a>
            <a href="#" class="tabbar-item">
                    <span class="tabbar-icon">
                        <i class="iconfont">&#xe621;</i>
                    </span>
                    <span class="tabbar-txt">购物车</span>
                </a>
            <a href="#" class="tabbar-item">
                    <span class="tabbar-icon">
                        <i class="iconfont">&#xe60d;</i>
                    </span>
                    <span class="tabbar-txt">个人中心</span>
                </a>
        </footer>
    </section>

  


<!-- 引入jQuery 2.0+ -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- 引入YDUI脚本 -->
<script src="../frame/ydui-0.1.3/build/js/ydui.js"></script>
<!-- Bootstrap 4 requires Popper.js -->
<script src="https://unpkg.com/popper.js@1.14.1/dist/umd/popper.min.js" crossorigin="anonymous"></script>


<script>
//  $('#J_Slider').slider({
//         speed: 200,
//         autoplay: 2000,
//         lazyLoad: true
//     });


// ------------------------------------------------------------------


$('.tabbar-item').eq(0).on("click",function () {
    location.href="../index.html"
    
})
$('.tabbar-item').eq(1).on("click",function () {
    location.href="./yimei.html"
   
})
$('.tabbar-item').eq(2).on("click",function () {
  
    location.reload()
    
})
$('.tabbar-item').eq(3).on("click",function () {
    location.href="./wode.html"
   
   
})


var jiiiw = []
var zongjia = 0
        function jfdskj(eq){
            if (eq.checked) {
                var eql = $(eq)
                console.log(eql.parent().children().eq(2).children().eq(2).children().eq(0).eq(0).attr("class","m-spinner J_Quantity6"));
                
            document.querySelector(`label[for="${eq.id}"]`).style.background = "orange";
        var joijdf =  eq.parentElement.children[2].lastElementChild.lastElementChild.innerText
        var jissdffge = joijdf.split('￥')
      
       zongjia+=parseFloat(jissdffge[1]) 
   
       $('.foiuhro').text(Math.floor(zongjia* 100) / 100+"RMB")
    //    ----
                jiiiw.push(eq.value)
            }else{

                var joijdfS =  eq.parentElement.children[2].lastElementChild.lastElementChild.innerText
        var jissdffgeS = joijdfS.split('￥')
     
       zongjia-=parseFloat(jissdffgeS[1]) 
       $('.foiuhro').text(Math.floor(zongjia* 100) / 100+"RMB")

                document.querySelector(`label[for="${eq.id}"]`).style.background = "white"
                for(let i=0;i<jiiiw.length;i++){
                 if(jiiiw[i]==eq.value){
                    jiiiw.splice(i,1);
                 break;
                     }
                    }
             
            }
           
            console.log(window.jiiiw);
            
     
          
        }

var jiod = localStorage['signature'];
var userid;
$.ajax({
    type: "post",
    url: "http://localhost/phpbox/onlinepro/php/execute/chaxx.php",
    data: {
            type :2,   qm:jiod   },
   
    success: function (response) {
        var sdfghh = JSON.parse(response)
            userid = sdfghh.data[0].id
            console.log(userid);
            goulist()
    }
});

    function goulist() {
        $.ajax({
            type: "post",
            url: "http://localhost/phpbox/onlinepro/php/execute/shopcar.php",
            data: {
                type:3,
                userid:userid
            },
            // dataType: "dataType",
            success: function (response) {
             
                var carlist = JSON.parse(response)
                console.log(carlist.data);
                shangshuba(carlist.data)
                
            }
        });
    }
    var jfw = 0
    var jojdwoe=0
    function shangshuba(array) {
        for (let i = 0; i < array.length; i++) {

            jfw++
                var djio = $('<div>')
                    djio.attr("class","list")
                    djio.html(`
                    <div class="disno"> ${array[i].goosid}  </div>
        <div class="imgkkk">
            <img src=${array[i].img} alt="">
        </div>
        <div class="tit">
                <p class="zssvd">${array[i].title}</p>
                <p class="dfsf">

                     
                            <span class="jsdiw">颜色：</span>
                            <span class="sdfhuwe">
                                ${array[i].color}
                            </span>
                            <span class="jsdiw">尺码：</span>
                            <span class="sdfhuwe">
                                ${array[i].size}
                                </span>
                                
                                
                </p>
                <p class="dhusdu">
                        <span class="m-spinner J_Quantity" >
    <a href="javascript:;" class="J_Del"></a>
    <input type="text" class="J_Input"  placeholder="" value="${array[i].num}"/>
    <a href="javascript:;" class="J_Add"></a>
</span>
        <span class="jiojiow"><span class="jiowe">￥</span>${Math.floor(((array[i].price *(array[i].zhe/10)) * 100) / 100) * array[i].num}</span>
                </p>
        </div>
        <label for="${"check" +jfw}" class="jdioiw" ></label>
        <input type="checkbox" name="check" id="${"check" +jfw}" value="${array[i].id}" onchange=jfdskj(this)>
 

                    
                    `)
                    $('.shopcar').append(djio)
            
        $('.J_Quantity').eq(i).spinner({
        input: '.J_Input',
        add: '.J_Add',
        minus: '.J_Del',
        unit: function () {
            return 1;
        },
        max: function () {
            return (1 + 2 + 3 + 4 + 5) * 5;
        },
        callback: function (value, $ele) {
            // $ele 当前文本框[jQuery对象]
   
             var fdff = $('.J_Input').eq(i).val();
     
            $('.jiojiow').eq(i).text("￥" +Math.floor(((array[i].price *(array[i].zhe/10)) * 100) / 100) * fdff);
            console.log($('.jiojiow').eq(i).text().split('￥')[1]);

            //  if (document.getElementsByName('check')[i].checked) {
            //     console.log($('.foiuhro').text());
            //  }
           
            
           
             
        }
    })

  

    for (let i = 0; i < jiosfpp.length; i++) {
                if (jiosfpp[i].checked) {
                console.log(jiosfpp[i]);
                
            }
                 
             }

        }
        
      

        // 
        $(".zssvd").each(function(){
       var len=$(this).text().length;   //当前HTML对象text的长度
      ;
       
       if(len>20){
           var str="";
           str=$(this).text().substring(0,20)+"...";  //使用字符串截取，获取前30个字符，多余的字符使用“......”代替
           $(this).html(str);                   //将替换的值赋值给当前对象
       }
    })
    }

    var jiosfpp =document.getElementsByName('check')
    function delcar() {
        $.ajax({
            type: "post",
            url: "http://localhost/phpbox/onlinepro/php/execute/shopcar.php",
            data: {type:99, delcar:jiiiw,id:userid},    
            success: function (response) {
                console.log(response);
                window.location.reload()
            }
        });
        
    }
  
  $('.dafsgas').on("click",function () {


     var jisoeew = jiiiw.join(',')
     console.log(jisoeew);
     
      window.location.href = "./jiesuan.html?dsfs="+jisoeew
      
  })
</script>
</body>
</html>